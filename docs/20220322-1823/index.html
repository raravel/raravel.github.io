<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Laravel을 써본 적 없는 Raravel"><meta name="keywords" content="javascript,typescript,nodejs,http"><meta name="author" content="raravel"><meta name="copyright" content="raravel"><meta property="og:title" content="성인사이트 우회 요청 해보기 | 라라벨의 블로그"><meta property="og:description" content="Laravel을 써본 적 없는 Raravel"><meta property="og:type" content="blog"><meta property="og:image" content="https://user-images.githubusercontent.com/28672888/178390670-e0f57978-950e-42c2-82e6-55feefcda83f.png"><title>성인사이트 우회 요청 해보기 | 라라벨의 블로그</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '클립보드에 복사되었습니다.',
    error: '클립보드에 복사할 수 없습니다.',
    noSupport: '해당 브라우저는 지원하지 않습니다.'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/feed.xml" title="라라벨의 블로그" type="application/rss+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://avatars.githubusercontent.com/u/28672888?v=4"></div><div class="author-info__name text-center"><a class="site-page" href="/">raravel</a></div><div class="author-info__description text-center">Laravel을 써본 적 없는 Raravel</div></div><hr><div class="sidebar-toc"><div class="sidebar-toc__title">목차</div><div class="sidebar-toc__progress"><span class="progress-notice">여기까지 읽었어요!</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%EA%B0%9C%EC%9A%94"><span class="toc-number">1.</span> <span class="toc-text">개요</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SNI-%EC%8A%A4%EB%8B%88%ED%95%91"><span class="toc-number">2.</span> <span class="toc-text">SNI 스니핑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPS-%ED%86%B5%EC%8B%A0"><span class="toc-number">2.1.</span> <span class="toc-text">HTTPS 통신</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TLS-%EC%95%85%EC%88%98"><span class="toc-number">2.2.</span> <span class="toc-text">TLS 악수</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS"><span class="toc-number">2.3.</span> <span class="toc-text">DNS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EA%B5%AC%ED%98%84"><span class="toc-number">3.</span> <span class="toc-text">구현</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-Message"><span class="toc-number">3.1.</span> <span class="toc-text">HTTP Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TLS"><span class="toc-number">3.2.</span> <span class="toc-text">TLS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML-%ED%8C%8C%EC%8B%B1"><span class="toc-number">3.3.</span> <span class="toc-text">HTML 파싱</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EB%A7%88%EB%AC%B4%EB%A6%AC"><span class="toc-number">4.</span> <span class="toc-text">마무리</span></a></li></ol></div></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">라라벨의 지인 목록</div><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://livefordev.tistory.com/">Livefordev</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://coxemonkey.tistory.com/">Coxemonkey</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://yummyhit.github.io/">yummiyHit</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.naver.com/thgus2270/">ppotatoG</a></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://user-images.githubusercontent.com/28672888/178390670-e0f57978-950e-42c2-82e6-55feefcda83f.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">라라벨의 블로그</a></span><div class="text-center" style="width: 100%">성인사이트 우회 요청 해보기</div></div><div id="post-info" style="background-color: rgba(0, 0, 0, 0.65)"><div id="post-title">성인사이트 우회 요청 해보기</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-03-22</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/nodejs/">nodejs</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/nodejs/javascript/">javascript</a><div class="post-meta-wordcount"><span>단어 수: </span><span class="word-count">1.1k</span><span class="post-meta__separator">|</span><span>읽는데 걸린 시간 : 6 분</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p><img src="https://user-images.githubusercontent.com/28672888/178390670-e0f57978-950e-42c2-82e6-55feefcda83f.png"></p>
<p>해당 글은 velog에 작성했던 글을 옮긴 것입니다. 무려 관심을 105개나 받으면서 월간 트렌딩에 올라갔던 글이지만, 불편하신 분들의 민원에 제목을 수정하였음에도 블라인드 처리된 비운의 글입니다. 이곳은 저밖에 없기 때문에 다시 수정하기 전 제목으로 옮깁니다.</p>
<p><img src="https://user-images.githubusercontent.com/28672888/178390956-f2932abc-9427-4f48-931c-02a5c6bf2354.png" alt="안내받은 메일"></p>
<h1 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h1><p><img src="https://user-images.githubusercontent.com/28672888/178391003-79534900-54f4-4582-b994-7aea9948b1f1.gif"></p>
<p>만약 글의 제목을 보고 흥미가 돋아 들어오셨다면, 당신은 어엿한 신사(또는 숙녀)입니다.</p>
<p>사실 이 행동은 2020년에 이루어졌으며, 그 때 어딘가에다가 글을 썼지만 잃어버려 이곳 벨로그에 쓰기 적당한 주제기에 새로 다시쓰기로 하였습니다.</p>
<blockquote>
<p>오늘의 목표는 www.(그)hub.com 에 요청을 보내고 응답받은 내용을 파싱하는 것 까지 해보겠습니다.</p>
</blockquote>
<hr>
<h1 id="SNI-스니핑"><a href="#SNI-스니핑" class="headerlink" title="SNI 스니핑"></a>SNI 스니핑</h1><p>2019년 그 시절 우리는 정부로부터 HTTPS 패킷을 감청한다는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://namu.wiki/w/2019%EB%85%84%20%EC%9D%B8%ED%84%B0%EB%84%B7%20%EA%B2%80%EC%97%B4%20%EB%85%BC%EB%9E%80">비극적인 소식</a>을 들었습니다.</p>
<p><img src="https://user-images.githubusercontent.com/28672888/178391137-6d0f2ad3-96d3-45c0-8a47-358daa641fc3.gif"></p>
<p>하지만 저는 신사답게 어떠한 시련이 저를 덮치더라도 이겨낸 뒤에 행복의 시간, 승리의 기쁨을 느껴야 합니다.</p>
<p>SNI 스니핑 방법을 이용해서 유해사이트를 판단, 차단한다고 하였는데요. 적을 알고 나를 안다면 백전 백승이듯, 이 기능이 무엇인지 잠깐 보도록 합시다.</p>
<h2 id="HTTPS-통신"><a href="#HTTPS-통신" class="headerlink" title="HTTPS 통신"></a>HTTPS 통신</h2><p><img src="https://user-images.githubusercontent.com/28672888/178391172-6f8a3ee1-9dda-429f-8570-b663ed0f41fe.png"></p>
<p>OSI 7계층을 보면 HTTP 밑에 TCP 프로토콜이 존재합니다. 물론, 정보의 바다에서 한 번쯤은 봤을만한 얘기죠. HTTP는 TCP 통신으로 진행됩니다. HTTPS는 TLS구요.</p>
<h2 id="TLS-악수"><a href="#TLS-악수" class="headerlink" title="TLS 악수"></a>TLS 악수</h2><blockquote>
<p>여기서 TLS Handshake에 대해 자세히 다루지 않습니다. 설명하려면 매우 귀찮으니 이거라도 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake/">링크</a>를 드리겠습니다.</p>
</blockquote>
<p>아무튼 TLS 핸드셰이크 진행중, 클라이언트가 서버에게 보내는 <code>Client Hello</code> 메시지의 내용을 봅시다.</p>
<p>글을 쓰는 현재 회사이므로 일하는 척 해야되기 때문에 브라우저가 아닌 프로그램으로 통신해보도록 하겠습니다.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> https <span class="keyword">from</span> <span class="string">&#x27;https&#x27;</span>;</span><br><span class="line"></span><br><span class="line">https.<span class="title function_">request</span>(&#123;</span><br><span class="line">	<span class="attr">hostname</span>: <span class="string">&#x27;(그)hub.com&#x27;</span>,</span><br><span class="line">	<span class="attr">port</span>: <span class="number">443</span>,</span><br><span class="line">	<span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">	<span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">&#125;, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Error: read ECONNRESET</span></span><br><span class="line"><span class="comment">    at TLSWrap.onStreamRead (node:internal/stream_base_commons:217:20) &#123;</span></span><br><span class="line"><span class="comment">  errno: -104,</span></span><br><span class="line"><span class="comment">  code: &#x27;ECONNRESET&#x27;,</span></span><br><span class="line"><span class="comment">  syscall: &#x27;read&#x27;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


<p>당연히 실패합니다. 브라우저가 아니라 소켓 자체가 끊거는 거니 제대로 된 통신이 불가했습니다. 하지만, 우리는 확실히 핸드셰이크 요청을 보냈죠.</p>
<p><img src="https://user-images.githubusercontent.com/28672888/178391343-9cc1b61e-5e24-4f2f-8b4d-3786dcb19696.png"></p>
<p><code>Client Hello</code> 메시지의 <code>server_name</code>이라는 옵션이 있습니다. 이 주소를 통해 차단할지 말지 정하고 있으니 이 항목을 없애버린 채 통신한다면? 우회가 될 것입니다.</p>
<p>이제부터 그 내용을 NodeJS로 진행해 보겠습니다.</p>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p><img src="https://user-images.githubusercontent.com/28672888/178391393-e35a3967-24d7-4d38-870d-752ee162563e.png"></p>
<p>일단 우린 URL 주소를 알고 있지만, 직접 TCP 소켓을 연결할 IP주소를 가져와야 합니다.</p>
<p>그러기 위해서 사용하는 게 DNS Lookup이지만, 이에 대한 자세한 기술적 설명은 다른 글이 더 좋으니 여기서 설명하지 않습니다.</p>
<p>NodeJS에서는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://nodejs.org/api/dns.html">dns 모듈</a>을 제공합니다.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promises <span class="keyword">as</span> dns, <span class="variable constant_">ADDRCONFIG</span>, <span class="variable constant_">V4MAPPED</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;dns&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> host = <span class="string">&#x27;www.(그)hub.com&#x27;</span>;</span><br><span class="line">	<span class="keyword">const</span> &#123; address &#125; = <span class="keyword">await</span> dns.<span class="title function_">lookup</span>(host, &#123;</span><br><span class="line">		<span class="attr">family</span>: <span class="number">4</span>,</span><br><span class="line">		<span class="attr">hints</span>: <span class="variable constant_">ADDRCONFIG</span> | <span class="variable constant_">V4MAPPED</span>,</span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ip address&#x27;</span>, address);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>위 코드를 실행해 보면 한 개의 IP 주소를 얻을 수 있습니다.</p>
<p>이제 이 주소에다가 나의 누나들, 아니. 나의 행복을 내놓으라고 요구하면 됩니다.</p>
<hr>
<h1 id="구현"><a href="#구현" class="headerlink" title="구현"></a>구현</h1><h2 id="HTTP-Message"><a href="#HTTP-Message" class="headerlink" title="HTTP Message"></a>HTTP Message</h2><p>이것도 세상 많은곳에 좋은 글이 퍼져있으니 자세히 설명하진 않습니다. 추천하는 글은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/ko/docs/Web/HTTP/Messages">이것</a>입니다.</p>
<p>위 주소에서 하나 인용해보겠습니다.</p>
<blockquote>
<p>HTTP 메시지는 ASCII로 인코딩된 텍스트 정보이며 여러 줄로 되어 있습니다.</p>
</blockquote>
<p>즉, HTTP 통신은 TCP로 소켓을 연결하고 사람이 이해할 수 있는 문장을 규격에 맞춰 보내준다면 쉽게 HTTP 통신이 가능하다는 뜻입니다.</p>
<p>예를 들어, 우리가 보낼 HTTP 메시지는 이렇게 되겠네요.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1 \n</span><br><span class="line">Host: (그)hub.com \n</span><br><span class="line">\n</span><br></pre></td></tr></table></figure>

<p>이 메시지를 아까 알아온 IP 주소에다가 보내봅시다.</p>
<h2 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h2><p>노드에서 아주 친절하게 net 모듈, 그리고 tls 모듈을 지원합니다. 그 모듈을 사용해 연결하고 메시지를 보내봅니다.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promises <span class="keyword">as</span> dns, <span class="variable constant_">ADDRCONFIG</span>, <span class="variable constant_">V4MAPPED</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;dns&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> tls <span class="keyword">from</span> <span class="string">&#x27;tls&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">whenReceive</span>(<span class="params">socket</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">			data += chunk;</span><br><span class="line">		&#125;);</span><br><span class="line">		socket.<span class="title function_">once</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">			socket.<span class="title function_">end</span>();</span><br><span class="line">			<span class="title function_">resolve</span>(data);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> host = <span class="string">&#x27;www.(그)hub.com&#x27;</span>;</span><br><span class="line">	<span class="keyword">const</span> &#123; address &#125; = <span class="keyword">await</span> dns.<span class="title function_">lookup</span>(host, &#123;</span><br><span class="line">		<span class="attr">family</span>: <span class="number">4</span>,</span><br><span class="line">		<span class="attr">hints</span>: <span class="variable constant_">ADDRCONFIG</span> | <span class="variable constant_">V4MAPPED</span>,</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> socket = tls.<span class="title function_">connect</span>(&#123;</span><br><span class="line">		<span class="attr">host</span>: address,</span><br><span class="line">		<span class="attr">port</span>: <span class="number">443</span>,</span><br><span class="line">		<span class="attr">rejectUnauthorized</span>: <span class="literal">false</span>,</span><br><span class="line">	&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="title function_">whenReceive</span>(socket)</span><br><span class="line">			.<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;recieve&#x27;</span>, data);</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		socket.<span class="title function_">write</span>([</span><br><span class="line">			<span class="string">&#x27;GET / HTTP/1.1&#x27;</span>,</span><br><span class="line">			<span class="string">`Host: <span class="subst">$&#123;host&#125;</span>`</span>,</span><br><span class="line">			<span class="string">&#x27;\n&#x27;</span>,</span><br><span class="line">		].<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>));</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>


<p>하지만 응답받은 값을 콘솔에 찍은 걸 보면 원하는 대로 통신이 안 됩니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">recieve HTTP/1.1 302 Found</span><br><span class="line">server: openresty</span><br><span class="line">date: Tue, 22 Mar 2022 08:59:06 GMT</span><br><span class="line">content-type: text/html; charset=UTF-8</span><br><span class="line">transfer-encoding: chunked</span><br><span class="line">cache-control: no-cache, no-store, must-revalidate</span><br><span class="line">pragma: no-cache</span><br><span class="line">ph-redirect: 1020</span><br><span class="line">location: 내 주소</span><br><span class="line">x-frame-options: SAMEORIGIN</span><br><span class="line">vary: User-Agent</span><br><span class="line">rating: RTA-5042-1996-1400-1577-RTA</span><br><span class="line">x-request-id: 62398FDA-42FE722901BB8E3F-D1846</span><br><span class="line">strict-transport-security: max-age=63072000; includeSubDomains; preload</span><br></pre></td></tr></table></figure>


<p><img src="https://user-images.githubusercontent.com/28672888/178391680-6a1fed46-aee2-41ab-9978-ddb81726d1a3.gif"></p>
<p>대충 서버님이 User-Agent를 담아서 보내라는 뜻입니다.<br>어라? 아까는 아예 연결조차 되지 않았는데 지금은 HTTP 메시지를 응답받은 상태입니다. 통신이 성공적으로 되었다는 뜻이죠.</p>
<p>좋습니다. HTTP Message를 작성하는 배열에 User-Agent 헤더를 담아봅니다.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">socket.<span class="title function_">write</span>([</span><br><span class="line">  <span class="string">&#x27;GET / HTTP/1.1&#x27;</span>,</span><br><span class="line">  <span class="string">`Host: <span class="subst">$&#123;host&#125;</span>`</span>,</span><br><span class="line">  <span class="string">&#x27;User-Agent: HereAgent&#x27;</span>, <span class="comment">// 이거</span></span><br><span class="line">  <span class="string">&#x27;\n&#x27;</span>,</span><br><span class="line">].<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>그러면 이상한 HTML 파일 내용을 우다다다 받게 됩니다. 곧 있으면 저는 누나들을 볼 수 있습니다. 아니, 이미 봤다고 해도 됩니다. 하지만 마지막 목표인 파싱까지만 해볼게요.</p>
<h2 id="HTML-파싱"><a href="#HTML-파싱" class="headerlink" title="HTML 파싱"></a>HTML 파싱</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promises <span class="keyword">as</span> dns, <span class="variable constant_">ADDRCONFIG</span>, <span class="variable constant_">V4MAPPED</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;dns&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> tls <span class="keyword">from</span> <span class="string">&#x27;tls&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> cheerio <span class="keyword">from</span> <span class="string">&#x27;cheerio&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">whenReceive</span>(<span class="params">socket</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		<span class="keyword">let</span> first = <span class="literal">true</span>;</span><br><span class="line">		socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> ( first ) &#123;</span><br><span class="line">				<span class="comment">// 첫 청크는 무조건 헤더이므로 거름</span></span><br><span class="line">				first = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 이후부터 Body 즉 HTML만 받음</span></span><br><span class="line">			data += chunk;</span><br><span class="line">		&#125;);</span><br><span class="line">		socket.<span class="title function_">once</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">			socket.<span class="title function_">end</span>();</span><br><span class="line">			<span class="title function_">resolve</span>(data);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> host = <span class="string">&#x27;www.(그)hub.com&#x27;</span>;</span><br><span class="line">	<span class="keyword">const</span> &#123; address &#125; = <span class="keyword">await</span> dns.<span class="title function_">lookup</span>(host, &#123;</span><br><span class="line">		<span class="attr">family</span>: <span class="number">4</span>,</span><br><span class="line">		<span class="attr">hints</span>: <span class="variable constant_">ADDRCONFIG</span> | <span class="variable constant_">V4MAPPED</span>,</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> socket = tls.<span class="title function_">connect</span>(&#123;</span><br><span class="line">		<span class="attr">host</span>: address,</span><br><span class="line">		<span class="attr">port</span>: <span class="number">443</span>,</span><br><span class="line">		<span class="attr">rejectUnauthorized</span>: <span class="literal">false</span>,</span><br><span class="line">	&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="title function_">whenReceive</span>(socket)</span><br><span class="line">			.<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">let</span> $ = cheerio.<span class="title function_">load</span>(data.<span class="title function_">trim</span>());</span><br><span class="line">				<span class="keyword">let</span> $pcList = $(<span class="string">&#x27;#mostRecentVideosSection&#x27;</span>).<span class="title function_">find</span>(<span class="string">&#x27;li.pcVideoListItem&#x27;</span>);</span><br><span class="line"></span><br><span class="line">				$pcList.<span class="title function_">each</span>(<span class="function">(<span class="params">idx, vid</span>) =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">const</span> te = $(vid).<span class="title function_">find</span>(<span class="string">&#x27;span.title a&#x27;</span>);</span><br><span class="line">					<span class="keyword">const</span> user = $(vid).<span class="title function_">find</span>(<span class="string">&#x27;div.usernameWrap a&#x27;</span>);</span><br><span class="line"></span><br><span class="line">					<span class="keyword">const</span> duration = $(vid).<span class="title function_">find</span>(<span class="string">&#x27;var.duration&#x27;</span>).<span class="title function_">text</span>().<span class="title function_">trim</span>();</span><br><span class="line">					<span class="keyword">const</span> url = <span class="string">&quot;https://&quot;</span> + host + te.<span class="title function_">attr</span>(<span class="string">&#x27;href&#x27;</span>)?.<span class="title function_">trim</span>();</span><br><span class="line">					<span class="keyword">const</span> title = te.<span class="title function_">text</span>().<span class="title function_">trim</span>()?.<span class="title function_">replace</span>(<span class="regexp">/\n/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">					<span class="keyword">const</span> userName = user.<span class="title function_">text</span>().<span class="title function_">trim</span>();</span><br><span class="line">					<span class="keyword">const</span> userHref = <span class="string">&quot;https://&quot;</span> + host + user.<span class="title function_">attr</span>(<span class="string">&#x27;href&#x27;</span>)?.<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Title     : <span class="subst">$&#123;title&#125;</span>`</span>);</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Duration  : <span class="subst">$&#123;duration&#125;</span>`</span>);</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Video Url : <span class="subst">$&#123;url&#125;</span>`</span>);</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`User Name : <span class="subst">$&#123;userName&#125;</span>`</span>);</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`User Url  : <span class="subst">$&#123;userHref&#125;</span>`</span>);</span><br><span class="line">					<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		socket.<span class="title function_">write</span>([</span><br><span class="line">			<span class="string">&#x27;GET / HTTP/1.1&#x27;</span>,</span><br><span class="line">			<span class="string">`Host: <span class="subst">$&#123;host&#125;</span>`</span>,</span><br><span class="line">			<span class="string">&#x27;User-Agent: HereAgent&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;\n&#x27;</span>,</span><br><span class="line">		].<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>));</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>위코드를 실행하게 되면 응답받은 HTML코드를 아래처럼 보여줍니다.</p>
<p><img src="https://user-images.githubusercontent.com/28672888/178391796-d8bc5aac-8745-42f8-96d2-4ba9c6e527cc.png"></p>
<hr>
<h1 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h1><p><img src="https://user-images.githubusercontent.com/28672888/178391828-31742c2e-6424-4fec-acdd-69becc528fa6.png"></p>
<p>오우야 오우야 참을 수 없습니다. 하지만 회사이기 때문에 참아야 합니다. 회사에서 월루해도 저는 오직 코딩과 공부와 공부를 정리하기만 했기 때문에 아주 틀린짓은 아닐지도 모르겠습니다.</p>
<p>재밌게 봐주셨다면 감사합니다.</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">작성자: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noopener noreferrer" target="_blank">raravel</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">주소: </span><span class="post-copyright-info"><a href="https://raravel.dev/20220322-1823/">https://raravel.dev/20220322-1823/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">저작권 고지: </span><span class="post-copyright-info">이 블로그의 모든 기사는 별도로 명시하지 않는 한 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 에 따라 라이선스가 부여됩니다.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/javascript/">javascript</a><a class="post-meta__tags" href="/tags/typescript/">typescript</a><a class="post-meta__tags" href="/tags/nodejs/">nodejs</a><a class="post-meta__tags" href="/tags/http/">http</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/20210721-1411/"><span>코드푸시로 완벽한 일렉트론 버전 관리</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="utterances-container"></div><script src="https://utteranc.es/client.js" issue-term="pathname" theme="github-light" crossorigin="anonymous" repo="raravel/raravel.github.io" async></script></div></div><footer class="footer-bg" style="background-image: url(https://user-images.githubusercontent.com/28672888/178390670-e0f57978-950e-42c2-82e6-55feefcda83f.png)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By raravel</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.2" zindex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>